---
import { siteConfig } from "../site.config";

const currentPath = Astro.url.pathname;
---

<header
  id="site-header"
  class="sticky top-0 z-50 bg-white transition-shadow duration-300"
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between md:h-20">
      <!-- Logo / Business Name -->
      <a href="/" class="flex items-center gap-2">
        <span class="text-xl font-bold text-brand-primary md:text-2xl">
          {siteConfig.name}
        </span>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden items-center gap-1 md:flex" aria-label="Main">
        {siteConfig.nav.map((link) => (
          <a
            href={link.href}
            class:list={[
              "rounded-md px-3 py-2 text-sm font-medium transition-colors",
              currentPath === link.href
                ? "bg-brand-light text-brand-primary"
                : "text-gray-600 hover:bg-gray-100 hover:text-brand-primary",
            ]}
          >
            {link.label}
          </a>
        ))}
      </nav>

      <!-- Phone CTA (desktop) -->
      <a
        href={`tel:${siteConfig.phone.replace(/\s/g, "")}`}
        class="hidden items-center gap-2 rounded-lg bg-brand-secondary px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-amber-600 md:inline-flex"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        {siteConfig.phone}
      </a>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        type="button"
        class="inline-flex items-center justify-center rounded-md p-2 text-gray-600 hover:bg-gray-100 hover:text-brand-primary md:hidden"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Toggle menu"
      >
        <svg id="menu-icon-open" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
        <svg id="menu-icon-close" class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden border-t border-gray-100 md:hidden">
    <nav class="space-y-1 px-4 pb-4 pt-2" aria-label="Mobile">
      {siteConfig.nav.map((link) => (
        <a
          href={link.href}
          class:list={[
            "block rounded-md px-3 py-2 text-base font-medium transition-colors",
            currentPath === link.href
              ? "bg-brand-light text-brand-primary"
              : "text-gray-600 hover:bg-gray-100 hover:text-brand-primary",
          ]}
        >
          {link.label}
        </a>
      ))}
      <a
        href={`tel:${siteConfig.phone.replace(/\s/g, "")}`}
        class="mt-2 flex items-center justify-center gap-2 rounded-lg bg-brand-secondary px-4 py-3 text-base font-semibold text-white transition-colors hover:bg-amber-600"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        Call {siteConfig.phone}
      </a>
    </nav>
  </div>
</header>

<script>
  const btn = document.getElementById("mobile-menu-btn")!;
  const menu = document.getElementById("mobile-menu")!;
  const iconOpen = document.getElementById("menu-icon-open")!;
  const iconClose = document.getElementById("menu-icon-close")!;
  const header = document.getElementById("site-header")!;

  btn.addEventListener("click", () => {
    const isOpen = menu.classList.toggle("hidden");
    iconOpen.classList.toggle("hidden", !isOpen);
    iconClose.classList.toggle("hidden", isOpen);
    btn.setAttribute("aria-expanded", String(!isOpen));
  });

  window.addEventListener("scroll", () => {
    if (window.scrollY > 10) {
      header.classList.add("shadow-md");
    } else {
      header.classList.remove("shadow-md");
    }
  });
</script>
